//NOTE: USE "PIPELINE" INSTEAD OF "PIPE". ERROR HANDLING IN "PIPE" IS DIFFICULT.
CONST { PIPELINE, TRANSFORM } = REQUIRE("STREAM");
CONST { CREATEREADSTREAM, CREATEWRITESTREAM } = REQUIRE("FS");

CONST WRITESTREAM = CREATEWRITESTREAM('TRANSFORM_UPPER.TXT')
CONST UPPER = NEW TRANSFORM()
//IMPLEMENT THE "_TRANSFORM" METHOD.
UPPER._TRANSFORM = FUNCTION (CHUNK, ENCODING, CALLBACK) {
    THIS.PUSH(CHUNK.TOSTRING().TOUPPERCASE());
    CALLBACK();
}

PIPELINE(
    CREATEREADSTREAM(__FILENAME),
    UPPER,
    WRITESTREAM,
    ERR => {
        IF (ERR) CONSOLE.LOG(`ERROR PROCESSING PIPELINE`);
        ELSE CONSOLE.LOG(`PIPELINE SUCCEEDED.`)
    })